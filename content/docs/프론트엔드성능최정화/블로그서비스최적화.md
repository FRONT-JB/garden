---
title: 1. 블로그 서비스 최적화
date: 2024-04-24
tags:
  - book
---
🔖 **오늘 읽은 범위 : 지은이의 글 ~ 1장 블로그 서비스 최적화**

> [!example]  소감 3줄 요약
> - lighthouse를 제대로 사용해본적이 없어서 작은 프로젝트를 시작으로 써봐야겠다는 생각이 들었다.
> - 이미지 최적화는 큰 서비스를 운영할 때 이점이 있을 것 같아서 아직까지는 무조건 도입 해야하는 건 아닌거 같다는 생각이 든다.
> - 구글 개발자도구 퍼포먼스 탭에 경험이 없어서 직접 보고 수정하기엔 어려운 부분이 있다.
> 


    😃 책에서 기억하고 싶은 내용을 써보세요.
## 성능 최적화는 왜 필요할까?
**웹 성능을 최적화 하면 가입률과 전환율은 높이고 이탈률은 낮춰 더 많은 수익을 창출할 수 있다.**
- `성능이 저하되면 사용자가 떠나고 매출이 감소한다.` 반대로 말하면 성능이 향상되면 그만큼 사용자가 늘고 매출이 오른다.
- 핀터레스트는 로딩 시간을 40% 줄임으로써 검색 유입률과 가입자 수를 15% 늘렸으며, COOK은 평균 페이지 로드 시간을 850밀리초로 줄여 세션당 페이지 조회수를 10% 늘렸고 이탈률은 7% 감소시켰다.

## 성능 최적화는 어떻게 이루어질까?
**웹 성능을 결정하는 요소는 크게 로딩 성능과 렌더링 성능으로 나눌 수 있다.**
### 로딩 성능
- 로딩 성능은 서버에 있는 웹 페이지와 웹 페이지에 필요한 기타 리소스를 다운로드할 때의 성능을 말한다.
- 로딩 성능을 개선하는 가장 좋은 방법은 다운로드해야 하는 리소스를 줄이거나 크기를 줄이는 것이다.
	- 코드 분할, 리소스 우선순위 지정
### 렌더링 성능
- 다운로드한 리소스를 가지고 화면에 그릴 때의 성능을 말한다.
	- 가장 큰 영향을 주는 것은 자바스크립트 코드
- 브라우저의 동작 원리나 사용하는 프레임워크의 라이프사이클 등 웹 개발의 기본적인 지식에 이해가 있어야 한다.

## Lighthouse 툴을 이용한 페이지 검사
### 크롬 개발자도구 Lighthouse로 검사하기
![[lighthouse-main.png]]
> [!tip] Mode와 Category 항목 값 소개
> **Mode**
>   - Navigation: Lighthouse의 기본 값으로 초기 페이지 로딩 시 발생하는 성능문제 분석
>   - Timespan: 사용자가 정의한 시간동안 발생한 성능문제 분석
>   - Snapshot: 현재 상태의 성능문제 분석
>   
> Categories
>   - Performance: 웹 페이지의 로딩 과정에서 발생하는 성능문제 분석
>   - Accessibility: 서비스의 사용자 접근성 문제 분석
>   - Best practices: 웹사이트의 보안 측면과 웹 개발의 최신 표준에 중점을 두고 분석
>   - SEO: 검색 엔진에서 얼마나 잘 크롤링 되고 검색 결과에 표시되는지 분석
>   - Progressive Web App: 서비스 워커와 오프라인 동작 등, PWA와 관련된 문제분석

### Lighthouse 검사 결과
- First Contentful Paint **(FCP)**
	- 페이지가 로드될 때 브라우저가 DOM 컨텐츠의 첫 번째 부분을 렌더링하는데 걸리는 시간 지표
- Speed Index **(SI)**
	- 페이지 로드 중에 콘텐츠가 시각적으로 표시되는 속도를 나타내는 지표
		- 동일한 시간이 걸리는 페이지라도 내부 컨텐츠가 노출되는 순서에 따라 더 높은 점수를 받는다.
- Largest Contentful Paint (LCP)
	- 페이지가 로드될 때 화면 내에 있는 가장 큰 이미지나 텍스트 요소가 렌더링되기까지 걸리는 시간을 나타내는 지표
- Time to Interactive (TTI)
	- 사용자가 페이지와 상호 작용이 가능한 시점까지 걸리는 시간을 측정한 지표
		- 이 시점 전까지는 화면이 보이더라도 클릭 같은 입력이 동작하지 않는다.
- Total Blocking Time (TBT)
	- 페이지가 클릭, 키보드 입력 등의 사용자 입력에 응답하지 않도록 차단된 시간을 총합한 지표
		- FCP와 TTI 사이의 시간 동안 일어나며 메인 스레드를 독점하여 다른 동작을 방해하는 작업에 걸린 시간을 총합
- Cumulative Layout Shift (CLS)
	- 페이지 로드 과정에서 발생하는 예기치 못한 레이아웃 이동을 측정한 지표
		- 레이아웃 이동이란 요소의 위치나 크기가 순간적으로 변하는 것으

#### Opportunities와 Diagnostics
Lighthouse 검색결과 하단에 위치한 이 두 섹션은 웹 페이지의 문제점과 해결 방안, 그리고 문제를 해결함으로써 얻을 수 있는 이점이 무엇인지 보여준다.
**Opportunities**는 페이지를 더욱 빨리 로드하는 데 잠재적으로 도움되는 제안을 보여주고 **Diagnostics**는 로드 속도와 직접적인 관계는 없지만 성능과 관련된 기타 정보를 보여준다.

### 이미지 사이즈 최적화
검사 결과에서 Opportunities 섹션을 확인하면 어떤 이미지가 적절하지 않은 사이즈인지 리스트로 볼 수 있다.
화면에 그려지는 사이즈보다 실제 이미지 사이즈가 큰 경우 문제가 발생하는데 자체적으로 가지고 있는 이미지의 경우 직접 이미지 사이즈를 조절하면 되지만 API를 통해 받아오는 경우에는 사이즈 조절이 쉽지 않다.
#### 이미지 CDN
위의 같은 상황에서 생각해 볼 수 있는 한 가지 방법은 Cloudinary나 Imgix 같은 이미지 CDN을 사용하는 방법이 있다. 
> [!tip] CDN(Content Delivery Network)
> CDN이란 물리적 거리의 한계를 극복하기 위해 소비자와 가까운 곳에 콘텐츠 서버를 두는 기술이다.
> 
> 예를 들면 한국에 있는 사용자가 미국에 있는 서버에서 이미지를 다운로드 하는 경우 미국에 있는 서버를 미리 한국으로 복사해두고 사용자가 이미지를 다운로드 하려고 할 때 미국서버가 아닌 한국 서버에서 다운로드 하도록 하는 것이다.
> 
> 이미지 사이즈를 줄이거나 특정 포맷으로 변경하는 작업이 가능하다.

### 병목 코드 최적화
검사 결과에서 Diagnostics 섹션을 확인하면 `Reduce Javascript execution time` 이라는 항목이 있을 수 있다. 항목을 펼쳐서 상세 정보를 확인해보면 가장 오랫동안 실행된 자바스크립트 파일을 확인할 수 있고 Perfomance 패널을 활용해 메인 스레드의 작업을 상세하게 살펴보고 느린 작업이 무엇인지 파악 할 수 있다.

#### Performance 패널
크롬 개발자 도구에서 Performance 패널로 이동해 상단 왼쪽에 위치한 새로고침 버튼을 누르면 페이지가 다시 로드되면서 그 과정에서의 여러 작업 (네트워크, 메인 스레드 등)을 기록하게 되는데 화면분석이 끝나면 CPU차트, Network 차트, 스크린샷, Network 타임라인, Frames, Timings, Main, 상세내용을 볼 수 있다.

**CPU 차트**
- CPU가 어떤 작업에 리소스를 사용하고 있는지 비율로 볼 수 있다.
	- 이 차트를 통해 어느 타이밍에 어떤 작업이 주로 진행되고 있는지 파악할 수 있다.
- 자바스크립트 실행 작업은 노란색, 렌더링/레이아웃 작업은 보라색, 페인팅 작업은 초록색, 기타 시스템 작업은 회색으로 표시된다.
- 차트 내 빨간색 선은 병목이 발생하는 지점을 의미하는데 특정 작업이 메인 스레드를 오랫동안 잡아두고 있다는 뜻이다.

**Network 차트**
- 대략적인 네트워크 상태를 보여주고 위쪽의 진한 막대는 우선순위가 높은 네트워크 리소스를, 아래쪽의 옅은 막대는 우선순위가 낮은 네트워크 리소스틀 나타낸다.

**스크린샷**
- 서비스가 로드되는 과정을 이미지로 볼 수 있다.

**Network 타임라인**
- 서비스 로드 과정에서의 네트워크 요청을 시간 순서에 따라 보여준다.
	- 왼쪽 회색선: 초기 연결 시간
	- 막대의 옅은 색 영역: 요청을 보낸 시점부터 응답을 기다리는 시점까지의 시간 (TTFB, Time to First Byte)
	- 막대의 짙은 색 영역: 컨텐츠 다운로드 시간
	- 오른쪽 회색 선: 해당 요청에 대한 메인 스레드의 작업 시간








